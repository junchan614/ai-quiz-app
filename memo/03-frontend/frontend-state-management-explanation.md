# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çŠ¶æ…‹ç®¡ç† - app-state.jsè§£èª¬

## ğŸ“ æ¦‚è¦

AIã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚è¤‡æ•°ã®ãƒšãƒ¼ã‚¸é–“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã€ã‚¯ã‚¤ã‚ºæƒ…å ±ãªã©ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚

## ğŸ”§ çŠ¶æ…‹ç®¡ç†ã¨ã¯ï¼Ÿ

### èº«è¿‘ãªä¾‹ã§ç†è§£ã™ã‚‹
**ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã®ä¾‹**:
- LINEã§ãƒˆãƒ¼ã‚¯ç”»é¢ã‹ã‚‰ãƒ›ãƒ¼ãƒ ç”»é¢ã«ç§»å‹•ã—ã¦ã‚‚ã€æœªèª­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã¯ä¿æŒã•ã‚Œã‚‹
- YouTubeã§å‹•ç”»ã‚’ä¸€æ™‚åœæ­¢ã—ã¦ã‚¢ãƒ—ãƒªã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚ã€å†ç”Ÿä½ç½®ãŒè¨˜æ†¶ã•ã‚Œã¦ã„ã‚‹
- Twitterã§ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’è¦‹ãŸå¾Œã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã«ç§»å‹•ã—ã¦ã‚‚ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒç¶™ç¶š

ã“ã‚Œã‚‰ã¯å…¨ã¦ã€ŒçŠ¶æ…‹ç®¡ç†ã€ã®ä¾‹ã§ã™ã€‚

### Webã‚¢ãƒ—ãƒªã§ã®èª²é¡Œ
```
å•é¡Œï¼šãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹
â”œâ”€â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ ã‚¯ã‚¤ã‚ºãƒšãƒ¼ã‚¸ç§»å‹•æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ¶ˆå¤±
â”œâ”€â”€ ã‚¯ã‚¤ã‚ºå›ç­”å¾Œ â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§çµ±è¨ˆãŒæ›´æ–°ã•ã‚Œãªã„
â””â”€â”€ ãƒ–ãƒ©ã‚¦ã‚¶æ›´æ–° â†’ ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚»ãƒƒãƒˆ
```

## ğŸ—ï¸ AppStateã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆæ€æƒ³

### 1. ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³
```javascript
const appState = new AppState(); // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«1ã¤ã ã‘
```
**åˆ©ç‚¹**:
- ã‚¢ãƒ—ãƒªå…¨ä½“ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰
- ã©ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼

### 2. ç®¡ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
```javascript
{
  user: { id, username, email },           // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
  stats: { total_answers, accuracy },      // çµ±è¨ˆæƒ…å ±
  currentQuiz: { question, options },      // ç¾åœ¨ã®ã‚¯ã‚¤ã‚º
  quizHistory: [/* å›ç­”å±¥æ­´ */]           // å±¥æ­´ãƒ‡ãƒ¼ã‚¿
}
```

## ğŸ“‹ ä¸»è¦æ©Ÿèƒ½ã®è©³ç´°è§£èª¬

### 1. ãƒ‡ãƒ¼ã‚¿ã®è¨­å®šã¨å–å¾—
```javascript
// ãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆè‡ªå‹•çš„ã«é€šçŸ¥ã¨ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰
appState.setUser({ id: 1, username: 'taro' });

// ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ï¼‰
const user = appState.getUser();
```

**ä»•çµ„ã¿**:
1. ãƒ¡ãƒ¢ãƒªã«ãƒ‡ãƒ¼ã‚¿ä¿å­˜
2. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«æ°¸ç¶šåŒ–
3. å¤‰æ›´ã‚’ç›£è¦–è€…ã«é€šçŸ¥

### 2. ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆç›£è¦–æ©Ÿèƒ½ï¼‰
```javascript
// çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã‚’ç›£è¦–
appState.subscribe('stats', (newStats) => {
  updateStatsDisplay(newStats);
});

// ãƒ‡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«UIã‚’æ›´æ–°
appState.setStats({ accuracy: 85 }); // â†’ ç”»é¢ãŒè‡ªå‹•æ›´æ–°
```

**åˆ©ç‚¹**:
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã«è‡ªå‹•ã§UIæ›´æ–°
- è¤‡æ•°ã®ç”»é¢è¦ç´ ã‚’åŒæœŸ
- ã‚³ãƒ¼ãƒ‰ã®çµåˆåº¦ã‚’ä¸‹ã’ã‚‹

### 3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é€£æº
```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶ã®æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ´»ç”¨
localStorage: {
  'aiQuiz_user': '{"id":1,"username":"taro"}',
  'aiQuiz_stats': '{"accuracy":85,"total":20}',
  'aiQuiz_currentQuiz': '{"question":"..."}'
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ãƒ‡ãƒ¼ã‚¿ä¿æŒ
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚æƒ…å ±ç¶­æŒ
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã§ã®å‚ç…§å¯èƒ½

## ğŸ¯ å®Ÿéš›ã®ä½¿ç”¨ä¾‹

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®æ´»ç”¨
```javascript
// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
document.addEventListener('DOMContentLoaded', async () => {
  // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¡¨ç¤º
  const cachedStats = appState.getStats();
  if (cachedStats) {
    displayUserStats(cachedStats);
  }

  // çµ±è¨ˆå¤‰æ›´ã‚’ç›£è¦–
  appState.subscribe('stats', displayUserStats);

  // æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const response = await fetch('/api/user/stats');
  const data = await response.json();
  appState.setStats(data.stats); // â†’ è‡ªå‹•ã§UIæ›´æ–°
});
```

### ã‚¯ã‚¤ã‚ºãƒšãƒ¼ã‚¸ã§ã®æ´»ç”¨
```javascript
// ã‚¯ã‚¤ã‚ºé–‹å§‹æ™‚
function startQuiz(quizData) {
  appState.setCurrentQuiz(quizData);
  displayQuizQuestion(quizData);
}

// å›ç­”æ™‚
function submitAnswer(answer) {
  const quiz = appState.getCurrentQuiz();
  const result = { quiz, answer, timestamp: new Date() };
  
  // å±¥æ­´ã«è¿½åŠ 
  appState.addToQuizHistory(result);
  
  // çµ±è¨ˆã‚’æ›´æ–°
  updateUserStats();
}
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¨ãƒ©ãƒ¼å‡¦ç†

### 1. ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
```javascript
// ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’ä¿è­·
loadFromStorage(key) {
  try {
    const item = localStorage.getItem(`aiQuiz_${key}`);
    return item ? JSON.parse(item) : null;
  } catch (error) {
    console.warn('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—:', error);
    return null; // å®‰å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  }
}
```

### 2. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢
```javascript
// ç›£è¦–è§£é™¤æ©Ÿèƒ½ã§ä¸è¦ãªãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
const unsubscribe = appState.subscribe('user', callback);
// ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«è§£é™¤
window.addEventListener('beforeunload', unsubscribe);
```

## ğŸŒŸ å¾“æ¥ã®æ–¹æ³•ã¨ã®æ¯”è¼ƒ

### Beforeï¼ˆå¾“æ¥ã®æ–¹æ³•ï¼‰
```javascript
// å„ãƒšãƒ¼ã‚¸ã§å€‹åˆ¥ã«ãƒ‡ãƒ¼ã‚¿å–å¾—
async function loadDashboard() {
  const userResponse = await fetch('/api/user/profile');
  const statsResponse = await fetch('/api/user/stats');
  // æ¯å›ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
}

// ãƒšãƒ¼ã‚¸ç§»å‹•ã§ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±
function goToQuizPage() {
  location.href = 'quiz.html';
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ¶ˆãˆã‚‹
}
```

### Afterï¼ˆçŠ¶æ…‹ç®¡ç†å°å…¥å¾Œï¼‰
```javascript
// ä¸€åº¦å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ©ç”¨
async function loadDashboard() {
  const cachedStats = appState.getStats();
  if (cachedStats) {
    displayUserStats(cachedStats); // å³åº§ã«è¡¨ç¤º
  }
  
  // å¿…è¦æ™‚ã®ã¿ã‚µãƒ¼ãƒãƒ¼å–å¾—
  if (shouldRefreshStats()) {
    const response = await fetch('/api/user/stats');
    appState.setStats(response.data);
  }
}
```

## ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### 1. æŠ€è¡“çš„ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**: ä¸è¦ãªã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰Šæ¸›
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ãƒšãƒ¼ã‚¸ç§»å‹•æ™‚ã®å¾…æ©Ÿæ™‚é–“çŸ­ç¸®
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: å…¨ç”»é¢ã§çµ±ä¸€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿è¡¨ç¤º

### 2. é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š
- **ã‚³ãƒ¼ãƒ‰å†åˆ©ç”¨**: åŒã˜ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±æœ‰
- **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“**: ä¸€ç®‡æ‰€ã§çŠ¶æ…‹ã‚’ç®¡ç†
- **æ©Ÿèƒ½æ‹¡å¼µ**: æ–°ã—ã„ãƒšãƒ¼ã‚¸ã§ã‚‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ã™ãåˆ©ç”¨

### 3. å®Ÿéš›ã®Webã‚¢ãƒ—ãƒªã§ã®é‡è¦æ€§
- **SPAï¼ˆSingle Page Applicationï¼‰**: Reactã€Vue.jsãªã©ã§å¿…é ˆ
- **PWAï¼ˆProgressive Web Appï¼‰**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã«å¿…è¦
- **å¤§è¦æ¨¡ã‚¢ãƒ—ãƒª**: ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®è¤‡é›‘ã•ã‚’è§£æ±º

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å¿œç”¨æŠ€è¡“ã®å­¦ç¿’
1. **Redux/Vuex**: ã‚ˆã‚Šé«˜åº¦ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
2. **WebSocket**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸ
3. **Service Worker**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†

### ä»Šå¾Œã®æ”¹å–„æ¡ˆ
1. **ãƒ‡ãƒ¼ã‚¿æœ‰åŠ¹æœŸé™**: å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è‡ªå‹•å‰Šé™¤
2. **åœ§ç¸®æ©Ÿèƒ½**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã®æœ€é©åŒ–
3. **åŒæœŸæ©Ÿèƒ½**: è¤‡æ•°ã‚¿ãƒ–é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰

## ğŸ“š ã¾ã¨ã‚

app-state.jsã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãŒã‚‰å®Ÿç”¨çš„ãªçŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
- **å•é¡Œè§£æ±º**: ãƒšãƒ¼ã‚¸é–“ã§ã®ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±ã‚’é˜²æ­¢
- **æ€§èƒ½å‘ä¸Š**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã§é«˜é€ŸåŒ–
- **é–‹ç™ºåŠ¹ç‡**: ä¸€å…ƒåŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ç®¡ç†

ã“ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šé«˜åº¦ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¸ã®é“ç­‹ãŒè¦‹ãˆã¦ãã¾ã™ã€‚