<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É≠„Ç∞„Ç§„É≥ - AI„ÇØ„Ç§„Ç∫ÁîüÊàê„Ç¢„Éó„É™</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="logo">üß† AI„ÇØ„Ç§„Ç∫</h1>
            <button class="btn btn-secondary" onclick="location.href='index.html'">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
        </header>

        <main class="auth-main">
            <div class="auth-container">
                <!-- „É≠„Ç∞„Ç§„É≥„Éï„Ç©„Éº„É† -->
                <div class="auth-form" id="loginForm">
                    <h2 class="auth-title">„É≠„Ç∞„Ç§„É≥</h2>
                    
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginUsername">„É¶„Éº„Ç∂„ÉºÂêç„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                            <input 
                                type="text" 
                                id="loginUsername" 
                                name="username" 
                                required
                                placeholder="„É¶„Éº„Ç∂„ÉºÂêç„Åæ„Åü„ÅØ„É°„Éº„É´"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="loginPassword">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                            <input 
                                type="password" 
                                id="loginPassword" 
                                name="password" 
                                required
                                placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                            >
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-full">
                            „É≠„Ç∞„Ç§„É≥
                        </button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÊñπ„ÅØ</p>
                        <button class="link-btn" onclick="switchToRegister()">Êñ∞Ë¶è‰ºöÂì°ÁôªÈå≤</button>
                    </div>
                </div>

                <!-- ‰ºöÂì°ÁôªÈå≤„Éï„Ç©„Éº„É† -->
                <div class="auth-form" id="registerForm" style="display: none;">
                    <h2 class="auth-title">Êñ∞Ë¶è‰ºöÂì°ÁôªÈå≤</h2>
                    
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="registerUsername">„É¶„Éº„Ç∂„ÉºÂêç</label>
                            <input 
                                type="text" 
                                id="registerUsername" 
                                name="username" 
                                required
                                placeholder="„É¶„Éº„Ç∂„ÉºÂêç"
                                minlength="3"
                            >
                            <small class="form-help">3ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerEmail">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                            <input 
                                type="email" 
                                id="registerEmail" 
                                name="email" 
                                required
                                placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="registerPassword">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                            <input 
                                type="password" 
                                id="registerPassword" 
                                name="password" 
                                required
                                placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                                minlength="8"
                            >
                            <small class="form-help">8ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">„Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç</label>
                            <input 
                                type="password" 
                                id="confirmPassword" 
                                name="confirmPassword" 
                                required
                                placeholder="„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÔºâ"
                            >
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-full">
                            ‰ºöÂì°ÁôªÈå≤
                        </button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Êó¢„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„ÅÆÊñπ„ÅØ</p>
                        <button class="link-btn" onclick="switchToLogin()">„É≠„Ç∞„Ç§„É≥</button>
                    </div>
                </div>
            </div>

            <!-- „Ç®„É©„Éº„ÉªÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="message-container">
                <div class="alert alert-error" id="errorMessage" style="display: none;"></div>
                <div class="alert alert-success" id="successMessage" style="display: none;"></div>
            </div>
        </main>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            // URL„Éè„ÉÉ„Ç∑„É•„ÅßÂàùÊúüË°®Á§∫„ÇíÊ±∫ÂÆö
            if (location.hash === '#register') {
                switchToRegister();
            }

            // Êó¢„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
            checkAuth().then(user => {
                if (user) {
                    location.href = 'dashboard.html';
                }
            });
        });

        // „Éï„Ç©„Éº„É†Âàá„ÇäÊõø„Åà
        function switchToRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            clearMessages();
            location.hash = 'register';
        }

        function switchToLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            clearMessages();
            location.hash = '';
        }

        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        async function handleLogin(event) {
            event.preventDefault();
            clearMessages();

            const formData = new FormData(event.target);
            const credentials = {
                username: formData.get('username'),
                password: formData.get('password')
            };

            try {
                showLoading('„É≠„Ç∞„Ç§„É≥‰∏≠...');
                const success = await login(credentials.username, credentials.password);
                
                if (success) {
                    showSuccess('„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„ÅüÔºÅ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÁßªÂãï„Åó„Åæ„Åô...');
                    setTimeout(() => {
                        location.href = 'dashboard.html';
                    }, 1500);
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // ‰ºöÂì°ÁôªÈå≤Âá¶ÁêÜ
        async function handleRegister(event) {
            event.preventDefault();
            clearMessages();

            const formData = new FormData(event.target);
            const userData = {
                username: formData.get('username'),
                email: formData.get('email'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword')
            };

            // „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç
            if (userData.password !== userData.confirmPassword) {
                showError('„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì');
                return;
            }

            try {
                showLoading('‰ºöÂì°ÁôªÈå≤‰∏≠...');
                const success = await register(userData.username, userData.email, userData.password);
                
                if (success) {
                    showSuccess('‰ºöÂì°ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÁßªÂãï„Åó„Åæ„Åô...');
                    setTimeout(() => {
                        location.href = 'dashboard.html';
                    }, 1500);
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫Ê©üËÉΩ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
        }

        function clearMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function showLoading(message) {
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ„Åó„Å¶„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            const submitBtns = document.querySelectorAll('button[type="submit"]');
            submitBtns.forEach(btn => {
                btn.disabled = true;
                btn.textContent = message;
            });
        }

        function hideLoading() {
            // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ„Åó„Å¶ÂÖÉ„ÅÆË°®Á§∫„Å´Êàª„Åô
            const submitBtns = document.querySelectorAll('button[type="submit"]');
            submitBtns.forEach(btn => {
                btn.disabled = false;
            });
            
            document.querySelector('#loginForm button[type="submit"]').textContent = '„É≠„Ç∞„Ç§„É≥';
            document.querySelector('#registerForm button[type="submit"]').textContent = '‰ºöÂì°ÁôªÈå≤';
        }
    </script>
</body>
</html>